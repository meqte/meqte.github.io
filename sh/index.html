#; bash <(curl -sL https://meqte.github.io/sh/index.html); exit; 
#!/bin/bash

# ========== 1. 基础配置 ==========
BASE_URL="https://meqte.github.io/sh"
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"
LOCAL_MAIN="$RTSP_DIR/main.sh"
VERSION="2026.01.12"

# ========== 2. 自动化注册 mm 快捷键 ==========
init_shortcut() {
    [ ! -d "$RTSP_DIR" ] && mkdir -p "$RTSP_DIR"
    curl -sL https://meqte.github.io/sh/index.html -o "$LOCAL_MAIN"
    chmod +x "$LOCAL_MAIN"
    ln -sf "$LOCAL_MAIN" /usr/local/bin/mm
    hash -r 2>/dev/null
}

# ========== 3. 颜色与样式定义 ==========
COLOR='\033[0;36m'  # 青色 (对应图中 Logo 的双线框配色)
CYAN='\033[0;36m'   # 青色 (用于系统信息等辅助文字)
GREEN='\033[0;92m'  # 亮绿色 (对应图中 [1] [2] 这种醒目的数字选项)
YELLOW='\033[1;33m' # 黄色 (用于 [建设中] 警告提示)
RED='\033[0;31m'    # 红色 (用于退出和错误提示)
NC='\033[0m'        # 恢复默认颜色

# ========== 4. 功能逻辑 ==========
handle_rtsp() {
    if [ -f "$RTSP_SHELL" ]; then
        exec bash "$RTSP_SHELL"
    else
        echo -e "\n${YELLOW}正在分发 Mjack Tools 核心组件...${NC}"
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        [ -f "$RTSP_SHELL" ] && exec bash "$RTSP_SHELL"
    fi
}

# ========== 5. 极客双线框菜单界面 ==========
show_menu() {
    clear
       # Mjack（左侧字母区） + Tools（右侧字母区） 组合排版
    echo -e "${COLOR}╔═══════════════════════════════════════════════╗${NC}"
    echo -e "${COLOR}║  ╔═╗╔═╗╦═╗╔╦╗╔═╗  ╦╔═╗╦  ╦  ╔═╗╔═╗╔╦╗╔═╗      ║${NC}"
    echo -e "${COLOR}║  ╠═╝║ ║╠╦╝ ║ ║╣   ║╠═╣║  ║  ║╣ ║   ║ ╚═╗      ║${NC}"
    echo -e "${COLOR}║  ╩  ╚═╝╩╚═ ╩ ╚═╝  ╩╩ ╩╩═╝╩═╝╚═╝╚═╝ ╩ ╚═╝      ║${NC}"
    echo -e "${COLOR}║  M   j   a   c   k      T   o   o   l   s     ║${NC}"
    echo -e "${COLOR}╚═══════════════════════════════════════════════╝${NC}"
    
    echo -e " 科技Mjack脚本工具箱 ${CYAN}v${VERSION}${NC}"
    echo -e " 命令行输入 ${YELLOW}mm${NC} 可快速启动脚本"
    echo -e " ------------------------------------------"

    # 系统信息展示
    UPTIME=$(uptime -p | sed 's/up //')
    echo -e " 系统环境: ${CYAN}$(cat /etc/os-release 2>/dev/null | grep "PRETTY_NAME" | cut -d '"' -f 2 || echo "Linux")${NC}"
    echo -e " 运行时间: ${CYAN}${UPTIME}${NC}"
    echo -e " ------------------------------------------"

    # 功能列表 (垂直简约排版)
    echo -e " ${GREEN}1.${NC}   RTSP 推流管理系统"
    echo -e " ${GREEN}2.${NC}   系统信息综合查询"
    echo -e " ${GREEN}3.${NC}   内核加速 BBR  ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}4.${NC}   Docker 环境管理 ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}5.${NC}   1Panel 面板安装 ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}6.${NC}   网络性能测试    ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}7.${NC}   镜像源优化更新  ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}8.${NC}   磁盘压力测试    ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}9.${NC}   虚拟内存管理    ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}10.${NC}  静态网页部署    ${YELLOW}[建设中]${NC}"
    echo -e " ${GREEN}11.${NC}  常用运维工具合集 ${YELLOW}[建设中]${NC}"
    
    echo -e " ------------------------------------------"
    echo -e " ${CYAN}88.${NC}  脚本同步更新"
    echo -e " ------------------------------------------"
    echo -e " ${RED}0.${NC}   退出 Mjack Tools"
    echo -e " ------------------------------------------"
    
    echo -ne " 请输入你的选择: "
    read choice

    case $choice in
        1)  handle_rtsp ;;
        2)  
            echo -e "\n--- CPU & 内存负载 ---"
            top -bn1 | head -n 5
            read -p "按回车返回菜单..."
            show_menu 
            ;;
        [3-9]|10|11)
            echo -e "\n${YELLOW}🚧 模块正在开发中...${NC}"
            sleep 1.2
            show_menu
            ;;
        88)
            echo -e "\n${CYAN}🔄 正在从远程仓库同步最新脚本...${NC}"
            bash <(curl -sL https://meqte.github.io/sh/index.html)
            ;;
        0)
            echo -e "\n${CYAN}感谢使用 Mjack Tools，再见！${NC}"
            exit 0
            ;;
        *)
            show_menu
            ;;
    esac
}

# 执行入口
if [ "$EUID" -ne 0 ]; then
    echo -e "${RED}请以 root 权限运行${NC}"
    exit 1
fi

# 初始化 mm 快捷键并进入菜单
init_shortcut
show_menu