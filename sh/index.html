#!/bin/bash

# ========== 配置区 ==========
# 你的 GitHub Pages 基础地址
BASE_URL="https://meqte.github.io/sh"
# 本地安装路径
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"

# 颜色定义
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

# 检查Root权限
if [ "$EUID" -ne 0 ]; then
    echo -e "${YELLOW}请以 root 权限运行此脚本 (sudo -i)${NC}"
    exit 1
fi

# 处理RTSP模块逻辑
handle_rtsp() {
    if [ -f "$RTSP_SHELL" ]; then
        echo -e "${GREEN}✅ 检测到 RTSP 工具已安装，正在启动管理面板...${NC}"
        bash "$RTSP_SHELL"
    else
        echo -e "${YELLOW}📡 本地未检测到组件，正在从云端获取安装程序...${NC}"
        # 核心：调用子目录下的安装脚本
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        
        # 再次检查是否安装成功
        if [ -f "$RTSP_SHELL" ]; then
            bash "$RTSP_SHELL"
        else
            echo -e "${RED}❌ 安装失败，请检查 GitHub 网络连接或路径配置。${NC}"
            read -p "按回车键返回菜单..."
            show_menu
        fi
    fi
}

show_menu() {
    clear
    echo -e "${BLUE}===========================================${NC}"
    echo -e "${GREEN}       欢迎使用 Meqte 一键工具箱           ${NC}"
    echo -e "${BLUE}===========================================${NC}"
    echo -e "  1. RTSP 推流服务器 (MediaMTX + FFmpeg)"
    echo -e "  2. 检查系统负载 (示例功能)"
    echo -e "  3. 建设中..."
    echo -e "  q. 退出脚本"
    echo -e "${BLUE}===========================================${NC}"
    read -p "请输入数字选择: " choice

    case $choice in
        1)
            handle_rtsp
            ;;
        2)
            uptime
            read -p "按回车键返回..."
            show_menu
            ;;
        q)
            exit 0
            ;;
        *)
            echo "无效输入"
            sleep 1
            show_menu
            ;;
    esac
}

show_menu