#; bash <(curl -sL https://meqte.github.io/sh/index.html); exit; 
#!/bin/bash

# ========== 1. 基础配置 ==========
BASE_URL="https://meqte.github.io/sh"
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"
LOCAL_MAIN="$RTSP_DIR/main.sh"
VERSION="2026.01.12"

# ========== 2. 自动化注册 mm 快捷键 ==========
init_shortcut() {
    [ ! -d "$RTSP_DIR" ] && mkdir -p "$RTSP_DIR"
    curl -sL https://meqte.github.io/sh/index.html -o "$LOCAL_MAIN"
    chmod +x "$LOCAL_MAIN"
    ln -sf "$LOCAL_MAIN" /usr/local/bin/mm
    hash -r 2>/dev/null
}

# ========== 3. 颜色与样式定义 (严格匹配图片) ==========
BOX_COLOR='\033[0;36m'   # 青色 - 用于外框
LOGO_TEXT='\033[1;36m'  # 亮青色 - 用于Logo内部文字
INFO_COLOR='\033[0;36m'  # 青色 - 用于系统信息
OPT_NUM='\033[0;92m'    # 亮绿色 - 用于选项序号 [1.]
WARN_COLOR='\033[1;33m' # 黄色 - 用于 [建设中]
EXIT_COLOR='\033[0;31m' # 红色 - 用于退出
NC='\033[0m'            # 恢复默认

# ========== 4. 功能逻辑 ==========
handle_rtsp() {
    if [ -f "$RTSP_SHELL" ]; then
        exec bash "$RTSP_SHELL"
    else
        echo -e "\n${WARN_COLOR}正在分发 Mjack Tools 核心组件...${NC}"
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        [ -f "$RTSP_SHELL" ] && exec bash "$RTSP_SHELL"
    fi
}

# ========== 5. 极客双线框菜单界面 ==========
show_menu() {
    clear
    # 修正后的极客双线框 Logo (严格对齐版)
    echo -e "${BOX_COLOR}╔═══════════════════════════════════════════════╗${NC}"
    echo -e "${BOX_COLOR}║${LOGO_TEXT}  ╔═╗╔═╗╦═╗╔╦╗╔═╗  ╦╔═╗╦  ╦  ╔═╗╔═╗╔╦╗╔═╗  ${BOX_COLOR}║${NC}"
    echo -e "${BOX_COLOR}║${LOGO_TEXT}  ╠═╝║ ║╠╦╝ ║ ║╣   ║╠═╣║  ║  ║╣ ║   ║ ╚═╗  ${BOX_COLOR}║${NC}"
    echo -e "${BOX_COLOR}║${LOGO_TEXT}  ╩  ╚═╝╩╚═ ╩ ╚═╝  ╩╩ ╩╩═╝╩═╝╚═╝╚═╝ ╩ ╚═╝  ${BOX_COLOR}║${NC}"
    echo -e "${BOX_COLOR}║${LOGO_TEXT}  ─────── M j a c k   T o o l s ───────  ${BOX_COLOR}║${NC}"
    echo -e "${BOX_COLOR}╚═══════════════════════════════════════════════╝${NC}"


    echo -e " 科技Mjack脚本工具箱 ${INFO_COLOR}v${VERSION}${NC}"
    echo -e " 命令行输入 ${WARN_COLOR}mm${NC} 可快速启动脚本"
    echo -e " ------------------------------------------"

    # 系统信息展示
    UPTIME=$(uptime -p | sed 's/up //')
    echo -e " 系统环境: ${INFO_COLOR}$(cat /etc/os-release 2>/dev/null | grep "PRETTY_NAME" | cut -d '"' -f 2 || echo "Linux")${NC}"
    echo -e " 运行时间: ${INFO_COLOR}${UPTIME}${NC}"
    echo -e " ------------------------------------------"

    # 功能列表
    echo -e " ${OPT_NUM}1.${NC}   RTSP 推流管理系统"
    echo -e " ${OPT_NUM}2.${NC}   系统信息综合查询"
    echo -e " ${OPT_NUM}3.${NC}   内核加速 BBR  ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}4.${NC}   Docker 环境管理 ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}5.${NC}   1Panel 面板安装 ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}6.${NC}   网络性能测试    ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}7.${NC}   镜像源优化更新  ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}8.${NC}   磁盘压力测试    ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}9.${NC}   虚拟内存管理    ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}10.${NC}  静态网页部署    ${WARN_COLOR}[建设中]${NC}"
    echo -e " ${OPT_NUM}11.${NC}  常用运维工具合集 ${WARN_COLOR}[建设中]${NC}"
    
    echo -e " ------------------------------------------"
    echo -e " ${INFO_COLOR}88.${NC}  脚本同步更新"
    echo -e " ------------------------------------------"
    echo -e " ${EXIT_COLOR}0.${NC}   退出 Mjack Tools"
    echo -e " ------------------------------------------"
    
    echo -ne " 请输入你的选择: "
    read choice

    case $choice in
        1)  handle_rtsp ;;
        2)  
            echo -e "\n--- CPU & 内存负载 ---"
            top -bn1 | head -n 5
            read -p "按回车返回菜单..."
            show_menu 
            ;;
        88)
            echo -e "\n${INFO_COLOR}🔄 正在同步最新版本...${NC}"
            bash <(curl -sL https://meqte.github.io/sh/index.html)
            ;;
        0)
            echo -e "\n${INFO_COLOR}感谢使用 Mjack Tools，再见！${NC}"
            exit 0
            ;;
        *)
            show_menu
            ;;
    esac
}

# 执行入口
if [ "$EUID" -ne 0 ]; then
    echo -e "${EXIT_COLOR}请以 root 权限运行${NC}"
    exit 1
fi

init_shortcut
show_menu