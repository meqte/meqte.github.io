#; bash <(curl -sL https://meqte.github.io/sh/index.html); exit; 
#!/bin/bash

# ========== 1. åŸºç¡€é…ç½® ==========
BASE_URL="https://meqte.github.io/sh"
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"
VERSION="2026.01.12"

# ========== 2. æé€Ÿè·³è¿‡é€»è¾‘ (æ ¸å¿ƒä¼˜åŒ–ç‚¹) ==========
# å¦‚æœæœ¬åœ°è„šæœ¬å­˜åœ¨ï¼Œä¸”ç”¨æˆ·æ²¡æœ‰ä¼ å…¥ --menu å‚æ•°ï¼Œåˆ™ç›´æ¥å¯åŠ¨æœ¬åœ°è„šæœ¬
# è¿™ä¼šè·³è¿‡æ‰€æœ‰ Logo æ˜¾ç¤ºå’Œèœå•ç­‰å¾…æ—¶é—´
if [ -f "$RTSP_SHELL" ] && [ "$1" != "--menu" ]; then
    exec bash "$RTSP_SHELL"
fi

# ========== 3. æ ·å¼å®šä¹‰ (ä»…åœ¨è¿›å…¥èœå•æ—¶åŠ è½½) ==========
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' 
BOLD='\033[1m'

# ========== 4. è¾…åŠ©å‡½æ•° ==========
draw_line() {
    echo -e "${BLUE}â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”${NC}"
}

check_root() {
    if [ "$EUID" -ne 0 ]; then
        echo -e "${RED}âŒ é”™è¯¯ï¼šè¯·ä½¿ç”¨ root æƒé™è¿è¡Œæ­¤è„šæœ¬ï¼${NC}"
        exit 1
    fi
}

handle_rtsp() {
    if [ -f "$RTSP_SHELL" ]; then
        # ä½¿ç”¨ exec æ„å‘³ç€å½“å‰è„šæœ¬è¿›ç¨‹ç»“æŸï¼Œç›´æ¥åˆ‡æ¢åˆ°ç›®æ ‡è„šæœ¬ï¼Œæ•ˆç‡æœ€é«˜
        exec bash "$RTSP_SHELL"
    else
        echo -e "\n${YELLOW}ğŸ“¡ æ­£åœ¨ä»äº‘ç«¯è·å– Mjack-RTSP éƒ¨ç½²ç»„ä»¶...${NC}"
        draw_line
        # è°ƒç”¨å®‰è£…è„šæœ¬
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        
        if [ -f "$RTSP_SHELL" ]; then
            echo -e "${GREEN}âœ… å®‰è£…å®Œæˆï¼ğŸ’¡ æç¤ºï¼šä¸‹æ¬¡å¯ç›´æ¥è¾“å…¥ [ m ] å¯åŠ¨ã€‚${NC}"
            sleep 1
            exec bash "$RTSP_SHELL"
        else
            echo -e "${RED}âŒ ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚${NC}"
            read -p "æŒ‰å›è½¦é”®è¿”å›..."
            show_menu
        fi
    fi
}

# ========== 5. ä¸»èœå• (ä»…åœ¨æœªå®‰è£…æˆ–å¼ºåˆ¶è¿›å…¥æ—¶æ˜¾ç¤º) ==========
show_menu() {
    clear
    echo -e "${CYAN}"
    echo "  __  __   _               _      _______            _       "
    echo " |  \/  | (_)             | |    |__   __|          | |      "
    echo " | \  / |  _   __ _   ___ | | __    | |  ___    ___ | | ___  "
    echo " | |\/| | | | / _\` | / __|| |/ /    | | / _ \  / _ \| |/ __| "
    echo " | |  | | | || (_| || (__ |   <     | || (_) || (_) || |\__ \ "
    echo " |_|  |_| |_| \__,_| \___||_|\_\    |_| \___/  \___/ |_||___/ "
    echo -e "${NC}"
    
    echo -e "${BOLD}${WHITE}  >>> Mjack æ•°å­—åŒ–ç®¡ç†å·¥å…·ç®± ${NC}  [ç‰ˆæœ¬: ${PURPLE}${VERSION}${NC}]"
    draw_line
    
    # ç®€å•çš„ç³»ç»Ÿæ¦‚è§ˆ
    OS_INFO=$(cat /etc/os-release 2>/dev/null | grep "PRETTY_NAME" | cut -d '"' -f 2 || echo "Linux")
    echo -e "  ${WHITE}ç³»ç»Ÿç¯å¢ƒ:${NC} ${OS_INFO}"
    draw_line
    
    echo -e "  ${GREEN}[1]${NC} ${WHITE}RTSP æ¨æµç®¡ç†${NC} ${CYAN}(MediaMTX)${NC}"
    echo -e "  ${GREEN}[2]${NC} å¼ºåˆ¶é‡æ–°å®‰è£…/æ›´æ–°ç»„ä»¶"
    draw_line
    echo -e "  ${PURPLE}[u]${NC} åŒæ­¥äº‘ç«¯æœ€æ–°ä»£ç "
    echo -e "  ${RED}[q]${NC} é€€å‡ºè„šæœ¬"
    draw_line
    
    echo -ne "  ${BOLD}è¯·é€‰æ‹©æ“ä½œ: ${NC}"
    read choice

    case $choice in
        1)
            handle_rtsp
            ;;
        2)
            echo -e "${YELLOW}æ­£åœ¨è¦†ç›–å®‰è£…...${NC}"
            bash <(curl -sL ${BASE_URL}/rtsp/index.html)
            handle_rtsp
            ;;
        u)
            echo -e "${BLUE}æ­£åœ¨åŒæ­¥...${NC}"
            bash <(curl -sL https://meqte.github.io/sh/index.html)
            ;;
        q)
            exit 0
            ;;
        *)
            show_menu
            ;;
    esac
}

# æ‰§è¡Œå…¥å£
check_root
show_menu