#; bash <(curl -sL https://meqte.github.io/sh/index.html); exit; 
#!/bin/bash

# ========================================================
# 脚本名称: Mjack 数字化多功能管理工具箱
# 适用系统: Ubuntu, Debian, CentOS, OpenWRT
# ========================================================

# ========== 1. 色彩与样式定义 ==========
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # No Color
BOLD='\033[1m'

# ========== 2. 基础配置 ==========
BASE_URL="https://meqte.github.io/sh"
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"
VERSION="2026.01.12"

# ========== 3. 辅助函数 ==========

# 绘制分割线
draw_line() {
    echo -e "${BLUE}————————————————————————————————————————————————————————————————————————————————${NC}"
}

# 检查Root权限
check_root() {
    if [ "$EUID" -ne 0 ]; then
        echo -e "${RED}❌ 错误：请使用 root 权限运行此脚本！${NC}"
        exit 1
    fi
}

# 核心逻辑：处理RTSP模块
handle_rtsp() {
    # 逻辑判断：如果本地存在脚本，说明已安装
    if [ -f "$RTSP_SHELL" ]; then
        echo -e "\n${GREEN}🚀 检测到 Mjack-RTSP 已安装，正在为您启动管理面板...${NC}"
        sleep 1
        bash "$RTSP_SHELL"
    else
        # 逻辑判断：如果本地不存在，则去下载
        echo -e "\n${YELLOW}📡 本地未检测到组件，正在从 Mjack 云端节点分发安装程序...${NC}"
        draw_line
        # 调用子目录下的安装脚本进行具体下载
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        
        # 下载完后再次检查
        if [ -f "$RTSP_SHELL" ]; then
            echo -e "${GREEN}✅ 部署成功！${NC}"
            sleep 1
            bash "$RTSP_SHELL"
        else
            echo -e "${RED}❌ 核心脚本缺失，安装失败！请检查 GitHub Pages 路径或网络。${NC}"
            read -p "按回车键返回主菜单..."
            show_menu
        fi
    fi
}

# ========== 4. 主菜单页面 ==========
show_menu() {
    clear
    # Mjack 艺术字 Logo
    echo -e "${CYAN}"
    echo "  __  __   _               _      _______            _       "
    echo " |  \/  | (_)             | |    |__   __|          | |      "
    echo " | \  / |  _   __ _   ___ | | __    | |  ___    ___ | | ___  "
    echo " | |\/| | | | / _\` | / __|| |/ /    | | / _ \  / _ \| |/ __| "
    echo " | |  | | | || (_| || (__ |   <     | || (_) || (_) || |\__ \ "
    echo " |_|  |_| |_| \__,_| \___||_|\_\    |_| \___/  \___/ |_||___/ "
    echo -e "${NC}"
    
    echo -e "${BOLD}${WHITE}  >>> Mjack 数字化多功能管理工具箱 ${NC}  [版本: ${PURPLE}${VERSION}${NC}]"
    draw_line
    
    # 系统状态展示
    if [ -f /etc/os-release ]; then
        OS_INFO=$(cat /etc/os-release | grep "PRETTY_NAME" | cut -d '"' -f 2)
    else
        OS_INFO="Unknown Linux"
    fi
    UPTIME=$(uptime -p)
    echo -e "  ${WHITE}系统环境:${NC} ${OS_INFO}"
    echo -e "  ${WHITE}运行时间:${NC} ${UPTIME}"
    draw_line
    
    # 功能选项列表
    echo -e "  ${GREEN}[1]${NC} ${WHITE}RTSP 推流服务器${NC} ${CYAN}(MediaMTX + FFmpeg)${NC}"
    echo -e "  ${GREEN}[2]${NC} 网络延迟及带宽测试 ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[3]${NC} 系统加速与优化 BBR ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[4]${NC} Docker 容器管理脚本 ${YELLOW}[建设中]${NC}"
    draw_line
    echo -e "  ${PURPLE}[u]${NC} 强制同步/更新远程脚本"
    echo -e "  ${RED}[q]${NC} 退出当前工具箱"
    draw_line
    
    echo -ne "  ${BOLD}请选择操作数字 [1-4 / u / q]: ${NC}"
    read choice

    case $choice in
        1)
            handle_rtsp
            show_menu
            ;;
        2|3|4)
            echo -e "\n${YELLOW}🚧 该模块正在紧急开发中，请关注 GitHub 更新！${NC}"
            sleep 2
            show_menu
            ;;
        u)
            echo -e "\n${BLUE}🔄 正在清理本地缓存并从云端同步最新代码...${NC}"
            # 重新调用自己，强制刷新
            bash <(curl -sL https://meqte.github.io/sh/index.html)
            ;;
        q)
            echo -e "\n${CYAN}感谢使用 Mjack Tools，祝您生活愉快！${NC}"
            exit 0
            ;;
        *)
            echo -e "\n${RED}无效选项，请输入正确的编号...${NC}"
            sleep 1
            show_menu
            ;;
    esac
}

# ========== 5. 执行入口 ==========
check_root
show_menu