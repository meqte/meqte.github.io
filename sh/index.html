#; bash <(curl -sL https://meqte.github.io/sh/index.html); exit; 
#!/bin/bash

# ========== 1. 基础配置 ==========
BASE_URL="https://meqte.github.io/sh"
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"
LOCAL_MAIN="$RTSP_DIR/main.sh"
VERSION="2026.01.12"

# ========== 2. 核心修复：mm 快捷键安装 ==========
# 确保目录存在
mkdir -p "$RTSP_DIR"

# 自动自愈：如果本地没有 main.sh，或者 mm 链接断了，强制重新安装
if [ ! -f "$LOCAL_MAIN" ] || [ ! -L "/usr/local/bin/mm" ]; then
    # 抓取当前脚本保存到本地，作为 mm 的实体文件
    curl -sL https://meqte.github.io/sh/index.html -o "$LOCAL_MAIN"
    chmod +x "$LOCAL_MAIN"
    # 创建软链接
    ln -sf "$LOCAL_MAIN" /usr/local/bin/mm
fi

# ========== 3. 样式定义 ==========
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' 
BOLD='\033[1m'

draw_line() {
    echo -e "${BLUE}————————————————————————————————————————————————————————————————————————————————${NC}"
}

handle_rtsp() {
    if [ -f "$RTSP_SHELL" ]; then
        # 如果已安装，瞬间跳转
        exec bash "$RTSP_SHELL"
    else
        echo -e "\n${YELLOW}📡 正在从云端下载 Mjack-RTSP 模块...${NC}"
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        [ -f "$RTSP_SHELL" ] && exec bash "$RTSP_SHELL"
    fi
}

# ========== 4. 主菜单 (Logo 已缩小 1/3) ==========
show_menu() {
    clear
    echo -e "${CYAN}"
    # 缩小后的精简版 Logo
    echo "  __  __      _            _      _______           _ "
    echo " |  \/  |    (_)          | |    |__   __|         | |"
    echo " | \  / |__ _ _  __ _  ___| | __    | | ___   ___  | |"
    echo " | |\/| / _\` | |/ _\` |/ __| |/ /    | |/ _ \ / _ \ | |"
    echo " | |  | (_| | | (_| | (__|   <     | | (_) | (_) | |"
    echo " |_|  |_|\__,_| |\__,_|\___|_|\_\    |_|\___/ \___/|_|"
    echo "            _/ |                                      "
    echo "           |__/                                       "
    echo -e "${NC}"
    echo -e "${BOLD}${WHITE}  >>> Mjack 数字化管理工具箱 ${NC}  [版本: ${PURPLE}${VERSION}${NC}]"
    draw_line
    
    echo -e "  ${GREEN}[1]${NC} ${WHITE}RTSP 推流管理系统${NC} ${CYAN}(MediaMTX)${NC}"
    echo -e "  ${GREEN}[2]${NC} BBR 内核加速设置  ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[3]${NC} Docker 环境一键安装 ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[4]${NC} 宝塔/1Panel 面板安装 ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[5]${NC} 系统网络测速 (Speed) ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[6]${NC} 常用源/镜像优化更新 ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[7]${NC} 磁盘性能压力测试    ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[8]${NC} 流量监控/带宽统计    ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[9]${NC} 虚拟内存 (Swap) 管理 ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[10]${NC} 静态网页一键部署    ${YELLOW}[建设中]${NC}"
    echo -e "  ${GREEN}[11]${NC} 常用运维工具箱 (集合) ${YELLOW}[建设中]${NC}"
    
    draw_line
    echo -e "  ${PURPLE}[88]${NC} 同步云端最新版本"
    echo -e "  ${RED}[0]${NC}  退出 Mjack 工具箱"
    draw_line
    
    echo -ne "  ${BOLD}请选择操作 [0-11 / 88]: ${NC}"
    read choice

    case $choice in
        1)  handle_rtsp ;;
        [2-9]|10|11)
            echo -e "\n${YELLOW}🚧 该模块正在紧急开发中...${NC}"
            sleep 1
            show_menu
            ;;
        88)
            echo -e "\n${BLUE}🔄 正在重新同步主脚本...${NC}"
            bash <(curl -sL https://meqte.github.io/sh/index.html)
            ;;
        0)
            echo -e "\n${CYAN}感谢使用，再见！${NC}"
            exit 0
            ;;
        *)
            show_menu
            ;;
    esac
}

# 执行入口
if [ "$EUID" -ne 0 ]; then
    echo -e "${RED}错误：请以 root 权限运行 (sudo -i)${NC}"
    exit 1
fi
show_menu