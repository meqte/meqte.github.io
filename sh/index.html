#; bash <(curl -sL https://meqte.github.io/sh/index.html); exit; 
#!/bin/bash

# ========== 1. 基础配置 ==========
BASE_URL="https://meqte.github.io/sh"
RTSP_DIR="/root/rtsp"
RTSP_SHELL="$RTSP_DIR/rtsp.sh"
LOCAL_MAIN="$RTSP_DIR/main.sh"
VERSION="2026.01.12"

# ========== 2. 自动注册 mm 快捷键 (静默完成) ==========
init_shortcut() {
    [ ! -d "$RTSP_DIR" ] && mkdir -p "$RTSP_DIR"
    curl -sL https://meqte.github.io/sh/index.html -o "$LOCAL_MAIN"
    chmod +x "$LOCAL_MAIN"
    ln -sf "$LOCAL_MAIN" /usr/local/bin/mm
    hash -r 2>/dev/null
}

# ========== 3. 样式定义 ==========
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'
BOLD='\033[1m'

# ========== 4. 功能逻辑 ==========
handle_rtsp() {
    if [ -f "$RTSP_SHELL" ]; then
        exec bash "$RTSP_SHELL"
    else
        echo -e "\n${YELLOW}正在分发 Mjack 核心组件...${NC}"
        bash <(curl -sL ${BASE_URL}/rtsp/index.html)
        [ -f "$RTSP_SHELL" ] && exec bash "$RTSP_SHELL"
    fi
}

# ========== 5. 简约风菜单界面 ==========
show_menu() {
    clear
    # 极简线框 Logo
    echo -e "${CYAN}"
    echo "  __  __ _            _    "
    echo " |  \/  (_) __ _  ___| | __"
    echo " | |\/| | |/ _\` |/ __| |/ /"
    echo " | |  | | | (_| | (__|   < "
    echo " |_|  |_|_|\__,_|\___|_|\_\\"
    echo -e "${NC}"
    
    echo -e " Mjack Tools 数字化脚本工具箱 ${CYAN}v${VERSION}${NC}"
    echo -e " 命令行输入 ${YELLOW}mm${NC} 可快速启动脚本"
    echo -e " ------------------------------------------"

    # 系统信息 (参考图中的简约排版)
    OS_INFO=$(cat /etc/os-release 2>/dev/null | grep "PRETTY_NAME" | cut -d '"' -f 2 || echo "Linux System")
    echo -e " 系统环境: ${OS_INFO}"
    echo -e " ------------------------------------------"

    # 功能列表 (带间隔排版)
    echo -e " ${CYAN}1.${NC}   RTSP 推流管理系统"
    echo -e " ${CYAN}2.${NC}   系统信息查询"
    echo -e " ${CYAN}3.${NC}   内核加速 BBR  ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}4.${NC}   Docker 管理   ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}5.${NC}   1Panel 安装   ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}6.${NC}   网络延迟测试  ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}7.${NC}   镜像源优化    ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}8.${NC}   磁盘性能测试  ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}9.${NC}   虚拟内存管理  ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}10.${NC}  静态网页部署  ${YELLOW}[建设中]${NC}"
    echo -e " ${CYAN}11.${NC}  运维工具合集  ${YELLOW}[建设中]${NC}"
    
    echo -e " ------------------------------------------"
    echo -e " ${CYAN}88.${NC}  脚本同步更新"
    echo -e " ------------------------------------------"
    echo -e " ${RED}0.${NC}   退出脚本"
    echo -e " ------------------------------------------"
    
    echo -ne " 请输入你的选择: "
    read choice

    case $choice in
        1)  handle_rtsp ;;
        2)  uptime; read -p "按回车继续..."; show_menu ;;
        [3-9]|10|11)
            echo -e "\n${YELLOW}🚧 模块开发中...${NC}"
            sleep 1
            show_menu
            ;;
        88)
            echo -e "\n${CYAN}正在同步代码...${NC}"
            bash <(curl -sL https://meqte.github.io/sh/index.html)
            ;;
        0)
            echo -e "\n${CYAN}已退出 Mjack Tools${NC}"
            exit 0
            ;;
        *)
            show_menu
            ;;
    esac
}

# 执行入口
if [ "$EUID" -ne 0 ]; then
    echo "请以 root 运行"
    exit 1
fi

init_shortcut
show_menu