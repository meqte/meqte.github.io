# Jack-Disk - 轻量临时文件存储工具（优化版）

Jack-Disk 是一个基于 Python Flask 框架开发的轻量级临时文件存储工具，支持用户通过浏览器匿名上传/下载文件，文件会在设定时间后自动删除。

## ✨ 主要特性

### 🚀 核心功能
- **拖拽上传**: 支持拖拽和点击选择文件上传
- **批量操作**: 支持批量下载、删除文件
- **文件预览**: 支持图片、文本文件在线预览
- **智能清理**: 自动清理过期文件，支持存储空间管理
- **实时统计**: 显示上传下载统计和存储使用情况

### 🔒 安全性增强
- **环境变量配置**: 管理员密码通过环境变量设置
- **会话管理**: 配置会话有效期30分钟
- **文件名安全**: 严格过滤特殊字符，防止路径注入
- **访问控制**: IP级别频率限制和错误处理

### 📊 性能优化
- **分片上传**: 大文件自动分片处理（大于100MB的文件）
- **元数据缓存**: 文件信息内存缓存，快速响应
- **智能清理**: 60分钟间隔检查，批量删除优化
- **前端优化**: 防抖搜索、响应式设计

### 🎨 用户体验
- **现代化UI**: Tailwind CSS + Heroicons 图标
- **响应式设计**: 完美适配PC、平板、手机
- **实时反馈**: 上传进度、操作状态、倒计时显示
- **搜索排序**: 支持文件名搜索和多维度排序

## 🚀 快速开始

### 环境要求
- Python 3.8 或更高版本
- 现代浏览器（Chrome、Firefox、Safari、Edge）

### 安装步骤

1. **克隆或下载项目**
```bash
git clone <repository-url>
cd jack-disk
```

2. **运行启动脚本**

Windows系统:
```batch
start.bat
```

Linux/Mac系统:
```bash
chmod +x start.sh
./start.sh
```

3. **访问应用**
打开浏览器访问: http://localhost:5000

### 手动安装

1. **安装依赖**
```bash
pip install -r requirements.txt
```

2. **设置环境变量**
```bash
export TEMPSTORE_ADMIN_PASSWORD="admin"
export TEMPSTORE_MAX_STORAGE="10GB"
export TEMPSTORE_MAX_FILE_SIZE="100MB"
export TEMPSTORE_FILE_EXPIRE_HOURS="24"
```

3. **启动服务**
```bash
python app.py
```

## ⚙️ 配置说明

### 环境变量

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| TEMPSTORE_ADMIN_PASSWORD | admin | 管理员密码 |
| TEMPSTORE_UPLOAD_DIR | ./uploads | 文件上传目录 |
| TEMPSTORE_MAX_STORAGE | 20GB | 总存储上限 |
| TEMPSTORE_MAX_FILE_SIZE | 1GB | 单个文件大小限制 |
| TEMPSTORE_FILE_EXPIRE_HOURS | 24 | 文件过期时间（小时） |
| TEMPSTORE_CLEAN_INTERVAL | 3600 | 清理检查间隔（秒） |
| TEMPSTORE_SESSION_TIMEOUT | 1800 | 管理员会话超时（秒） |

### 管理员功能

1. **访问配置面板**
   - 点击右上角设置图标
   - 输入管理员密码登录
   - 支持配置参数实时修改

2. **查看系统日志**
   - 在配置面板中点击"查看日志"
   - 支持按日志级别筛选
   - 实时查看系统运行状态

3. **系统监控**
   - 实时存储使用情况
   - 上传下载统计
   - 文件数量和运行时间

## 📁 项目结构

```
jack-disk/
├── app.py                    # 后端主应用
├── index.html                # 前端页面
├── main.js                   # 前端JavaScript代码
├── tailwind.css              # Tailwind CSS样式文件
├── requirements.txt          # Python依赖
├── start.bat                 # Windows启动脚本
├── start.sh                  # Linux/Mac启动脚本
├── uploads/                  # 文件存储目录（自动创建）
├── jack-disk.log            # 系统日志文件（自动生成）
└── metadata.json            # 文件元数据（自动生成）
```

## 🔧 技术架构

### 后端技术
- **Flask 2.3.3**: 轻量级Web框架
- **APScheduler 3.10.4**: 定时任务调度
- **Werkzeug 2.3.7**: WSGI工具集和文件处理
- **原生Python库**: uuid, hashlib, logging, pathlib

### 前端技术
- **HTML5 + CSS3 + ES6+**: 现代化前端技术
- **Tailwind CSS**: 实用优先的CSS框架
- **Heroicons**: 精美的SVG图标
- **原生JavaScript API**: 拖拽、文件处理、AJAX

### 核心特性
- **RESTful API**: 统一的接口设计
- **文件分片存储**: 按日期分目录存储
- **元数据管理**: JSON格式存储文件信息
- **内存缓存**: 提高响应速度
- **错误处理**: 完善的异常捕获和日志记录

## 🎯 使用指南

### 文件上传
1. **拖拽上传**: 将文件拖拽到上传区域
2. **点击上传**: 点击"选择文件"按钮选择文件
3. **批量上传**: 支持同时选择多个文件
4. **文件夹上传**: 支持拖拽文件夹（自动处理）

### 文件管理
1. **文件列表**: 显示所有未过期文件
2. **搜索功能**: 实时搜索文件名
3. **排序功能**: 支持按时间、名称、大小排序
4. **批量操作**: 全选、批量下载、批量删除
5. **文件预览**: 点击图片、文本文件可预览

### 文件下载
1. **单个下载**: 点击下载按钮直接下载
2. **批量下载**: 选择多个文件后批量下载
3. **下载统计**: 显示每个文件的下载次数

### 自动清理
1. **过期清理**: 文件超过设定时间自动删除
2. **空间管理**: 存储空间不足时自动清理旧文件
3. **清理日志**: 记录所有清理操作

## 🔒 安全考虑

### 已实施的安全措施
1. **文件名过滤**: 使用werkzeug.secure_filename处理
2. **路径注入防护**: 严格限制文件路径
3. **文件类型检查**: MIME类型验证
4. **大小限制**: 防止超大文件上传
5. **错误信息脱敏**: 不暴露系统内部信息
6. **会话管理**: 管理员操作需要认证

### 生产环境建议
1. **使用HTTPS**: 启用SSL/TLS加密
2. **反向代理**: 使用Nginx等反向代理
3. **防火墙配置**: 限制访问IP和端口
4. **定期备份**: 备份配置文件和重要数据
5. **监控告警**: 设置系统监控和告警

## 🐛 故障排除

### 常见问题

1. **端口被占用**
   - 检查端口5000是否被其他程序占用
   - 修改启动脚本使用其他端口

2. **权限问题**
   - 确保有读写uploads目录的权限
   - Linux/Mac系统给启动脚本执行权限

3. **依赖安装失败**
   - 确保Python版本符合要求
   - 使用虚拟环境安装依赖

4. **文件上传失败**
   - 检查磁盘空间是否充足
   - 检查文件大小是否超过限制
   - 查看日志文件获取详细信息

### 日志查看
```
# 查看实时日志
tail -f jack-disk.log

# 查看错误日志
grep ERROR jack-disk.log

# 查看最近100条日志
tail -n 100 jack-disk.log
```

## 📈 性能调优

### 配置优化建议
1. **文件大小限制**: 根据实际需求调整
2. **清理间隔**: 文件量大时缩短清理间隔
3. **存储上限**: 根据磁盘空间合理设置
4. **会话超时**: 管理员操作频繁时适当延长

### 系统优化
1. **磁盘I/O**: 使用SSD提高文件读写性能
2. **内存配置**: 根据并发量调整内存分配
3. **网络带宽**: 确保足够的网络带宽
4. **定期维护**: 定期清理日志和临时文件

## 🤝 联系方式

如有问题或建议，请联系项目维护者。